# Railway project configuration
# Docs: https://docs.railway.com/reference/config-as-code
#
# Deploy structure:
#   - api   → apps/api/Dockerfile  (this file; NestJS + Prisma)
#   - web   → apps/web/Dockerfile  (set RAILWAY_DOCKERFILE_PATH=apps/web/Dockerfile on the web service!)
#   - db    → Railway PostgreSQL plugin (add via dashboard)
#
# Web service: set RAILWAY_DOCKERFILE_PATH=apps/web/Dockerfile and Healthcheck Path = /health (see docs/railway-deploy.md)
#
# Required environment variables per service:
#
# [api]
#   DATABASE_URL        — from Railway PostgreSQL plugin (set automatically)
#   JWT_ACCESS_SECRET   — strong random string
#   JWT_REFRESH_SECRET  — strong random string
#   CORS_ORIGIN         — your web service public URL  (e.g. https://web-xxx.railway.app)
#   SENTRY_DSN          — from sentry.io project settings (optional)
#   PORT                — set automatically by Railway
#
# [web]
#   API_URL             — your api service public URL  (e.g. https://api-xxx.railway.app/api)
#   SENTRY_DSN          — same DSN as API, or a separate browser project (optional)

[build]
  dockerfilePath = "apps/api/Dockerfile"

[deploy]
  # Must match an existing route: Nest uses global prefix "api", health is at /api/health (GET /api returns 404)
  healthcheckPath = "/api/health"
  healthcheckTimeout = 60
  restartPolicyType = "on_failure"
  restartPolicyMaxRetries = 3
